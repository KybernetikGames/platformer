<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/platformer/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/platformer/assets/img/favicon.ico" type="image/x-icon">
        <title>Platformer Game Kit - Ranged Attacks</title>
        <link href="/platformer/assets/css/highlight.css" rel="stylesheet">
        <link href="/platformer/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/platformer/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/platformer/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/platformer/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/platformer/assets/css/override.css" rel="stylesheet">
        <script src="/platformer/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/platformer/assets/js/bootstrap.min.js"></script>        
        <script src="/platformer/assets/js/app.min.js"></script>         
        <script src="/platformer/assets/js/highlight.pack.js"></script>   
        <script src="/platformer/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/platformer/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/platformer/assets/js/mermaid.min.js"></script>
        <script src="/platformer/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/platformer/assets/js/html5shiv.min.js"></script>
        <script src="/platformer/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/platformer/" class="logo">
                            <span>Platformer Game Kit</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/platformer/docs"><img src="/platformer/images/docs.png" height="20px" width="7.5px" style="left:-5px"> Documentation</a></li>
        <li><a href="/platformer/docs/package/download"><img src="/platformer/images/unity-logo.png" height="20px" width="19.0625px" style="left:-4px"> Download</a></li>
        <li><a href="/platformer/api/PlatformerGameKit"><img src="/platformer/images/api.png" height="20px" width="18.125px" style="left:-3px"> API v1.0</a></li>
        <li><a href="/platformer/docs/package/contact"><img src="/platformer/images/contact.png" height="20px" width="19.6875px" style="left:-4px"> Contact</a></li>
        <li><a href="/kailas-dierk/unity-assets"><img src="/platformer/images/kybernetik.png" height="20px" width="20px" style="left:-2px"> Other Assets</a></li>

<li style="width:100%">
<form class="search-form" name="search" action="/animancer/search">
<span><input class="search-input" id="search" name="q" type="text" placeholder="Search..."></span>
<div class="search-button"><button type="submit"><i class="fa fa-search"></i></button></div>
</form>
</li> 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#fields">Fields</a></p>
<p><a href="#fire">Fire</a></p>
<p><a href="#projectiles">Projectiles</a></p>
<p><a href="#impact-animation">Impact Animation</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li class="treeview">
                    <a href="/platformer/docs/package">Package</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/package/download">Download</a></li>
                <li><a href="/platformer/docs/package/contact">Contact</a></li>
                <li><a href="/platformer/docs/package/license">License</a></li>

                    </ul>
                </li>
                <li><a href="/platformer/docs/scenes">Scenes</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/art">Art</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/art/import">Import</a></li>
                <li><a href="/platformer/docs/art/organization">Organization</a></li>
                <li><a href="/platformer/docs/art/animations">Animations</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters">Characters</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/character">Character Component</a></li>
                <li><a href="/platformer/docs/characters/animancer">Animancer Component</a></li>
                <li><a href="/platformer/docs/characters/physics">Physics</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/brains">Brains</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/brains/player">Player Input Brain</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/brains/behaviour">Behaviour Tree Brain</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/brains/behaviour/introduction">Introduction</a></li>
                <li><a href="/platformer/docs/characters/brains/behaviour/general">General Nodes</a></li>
                <li><a href="/platformer/docs/characters/brains/behaviour/specific">Specific Nodes</a></li>
                <li><a href="/platformer/docs/characters/brains/behaviour/enemies">Enemies</a></li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states">States</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/introduction">Introduction</a></li>
                <li><a href="/platformer/docs/characters/states/multi-state">Multi-State</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states/idle">Idle</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/idle/idle">Idle</a></li>
                <li><a href="/platformer/docs/characters/states/idle/mobile-idle">Mobile Idle</a></li>
                <li><a href="/platformer/docs/characters/states/idle/locomotion">Locomotion</a></li>
                <li><a href="/platformer/docs/characters/states/idle/wall-slide">Wall Slide</a></li>
                <li><a href="/platformer/docs/characters/states/idle/land">Land</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states/jump">Jump</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/jump/jump">Jump</a></li>
                <li><a href="/platformer/docs/characters/states/jump/hold">Hold Jump</a></li>
                <li><a href="/platformer/docs/characters/states/jump/wall">Wall Jump</a></li>
                <li><a href="/platformer/docs/characters/states/jump/air">Air Jump</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states/attack">Attack</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/attack/basic">Basic Action</a></li>
                <li><a href="/platformer/docs/characters/states/attack/advanced">Advanced Attack</a></li>
                <li><a href="/platformer/docs/characters/states/attack/side">Side Attack</a></li>

                    </ul>
                </li>
                <li><a href="/platformer/docs/characters/states/flinch">Flinch</a></li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/platformer/docs/combat">Combat</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/combat/hits">Hits</a></li>
                <li><a href="/platformer/docs/combat/melee">Melee Attacks</a></li>
                <li class="selected"><a href="/platformer/docs/combat/ranged">Ranged Attacks</a></li>
                <li><a href="/platformer/docs/combat/teams">Teams</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/other">Other Topics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/other/camera-man">Camera Man</a></li>
                <li><a href="/platformer/docs/other/camera-shake">Camera Shake</a></li>
                <li><a href="/platformer/docs/other/layers">Physics Layers</a></li>
                <li><a href="/platformer/docs/other/moving">Moving Platforms</a></li>

                    </ul>
                </li>
                <li><a href="/platformer/docs/changes">Changes</a></li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>Ranged Attacks</h1>
		</section>
	<section class="content">
		<img src="throw-inspector.png" class="img-responsive img-right">
<p><img src="../../characters/states/attack/basic/throw.gif" class="img-responsive"></p>
<p>Ranged attacks involve a character playing an animation during which a <a href="#projectiles">Projectile</a> is fired. The action itself is implemented by the <code>ProjectileAttackTransition</code> class which inherits from Animancer's regular <code>ClipTransition</code>. This allows it to be selected as the animation on a <a href="../../characters/states/attack/basic">Basic Action State</a>.</p>
<h1 id="fields">Fields</h1>
<p>The fields have tooltips to explain what they do:</p>
<pre><code class="language-cs">[Serializable]
public partial class ProjectileAttackTransition : ClipTransition
{
    [SerializeField]
    [Tooltip("The prefab that will be instantiated to create the projectile")]
    private Projectile _ProjectilePrefab;
    public ref Projectile ProjectilePrefab =&gt; ref _ProjectilePrefab;

    [SerializeField]
    [Tooltip("The local position where the projectile will be created")]
    private Vector2 _LaunchPoint;
    public ref Vector2 LaunchPoint =&gt; ref _LaunchPoint;

    [SerializeField, MetersPerSecond]
    [Tooltip("The initial speed the projectile will be given")]
    private float _LaunchSpeed;
    public ref float LaunchSpeed =&gt; ref _LaunchSpeed;

    [SerializeField]
    [Tooltip("The amount of damage the projectile will deal")]
    private int _Damage;
    public ref int Damage =&gt; ref _Damage;
</code></pre>
<h1 id="fire">Fire</h1>
<p>Rather than launching the projectile at the very start or end of the animation, it uses an <a href="/animancer/docs/manual/events/animancer">Animancer Event</a> to tell it when to fire. It uses an <a href="/animancer/docs/manual/events/animancer#event-names">Event Names</a> attribute so that the correct name can be selected from a dropdown menu in the Inspector instead of needing to be typed manually:</p>
<pre><code class="language-cs">[Serializable]
[EventNames(EventName)]
public partial class ProjectileAttackTransition : ClipTransition, ISerializationCallbackReceiver
{
    public const string EventName = "Fire";

    ...
</code></pre>
<p>Then it uses <a href="https://docs.unity3d.com/ScriptReference/ISerializationCallbackReceiver.OnAfterDeserialize.html"><code>ISerializationCallbackReceiver.OnAfterDeserialize</code></a> to find the event with that name and assign the <code>Fire</code> method as its callback:</p>
<pre><code class="language-cs">    void ISerializationCallbackReceiver.OnBeforeSerialize() { }

    void ISerializationCallbackReceiver.OnAfterDeserialize()
    {
#if ! UNITY_EDITOR
        // Animancer Events are Pro-Only so they don't work in Animancer Lite at runtime.
        if (!AnimancerUtilities.IsAnimancerPro)
            return;
#endif

        if (_ProjectilePrefab != null)
        {
            Events.SetCallback(EventName, Fire);
        }
    }
</code></pre>
<p>When the <code>Fire</code> event occurs, it gets the character that triggered the event:</p>
<pre><code class="language-cs">    private void Fire()
    {
        var attacker = CharacterAnimancerComponent.GetCurrent();
</code></pre>
<p>Then calculates the position and rotation to launch with:</p>
<pre><code class="language-cs">        var facing = attacker.Facing;
        var facingLeft = attacker.FacingLeft;

        var position = CalculateLaunchPosition(attacker.Character.Body.Position, facingLeft);

        var angle = Mathf.Atan2(facing.y, facing.x) * Mathf.Rad2Deg;
        if (facingLeft)
            angle -= 180;

        var rotation = Quaternion.Euler(0, 0, angle);
</code></pre>
<p>Then instantiates the <code>_ProjectilePrefab</code> and fires it:</p>
<pre><code class="language-cs">        var projectile = Object.Instantiate(_ProjectilePrefab, position, rotation);
        projectile.Fire(facing * _LaunchSpeed, attacker.Character.Health.Team, _Damage, null);
        projectile.Renderer.flipX = facingLeft;
    }

    private Vector2 CalculateLaunchPosition(Vector2 position, bool flipX)
    {
        var launchPosition = _LaunchPoint;
        if (flipX)
            launchPosition.x = -launchPosition.x;

        return position + launchPosition;
    }
}
</code></pre>
<h1 id="projectiles">Projectiles</h1>
<p>The <code>Projectile</code> component manages the launching and impact of projectiles.</p>
<p><img src="projectile-inspector.png" class="img-responsive"></p>
<p>It has several <a href="/animancer/docs/introduction/cs/variables#serialized-fields">Serialized Fields</a>:</p>
<ul>
<li>A <code>Rigidbody2D</code> to set the velocity when launched.</li>
<li>A <code>SpriteRenderer</code> which isn't used in this class, but the <code>ProjectileAttackTransition</code> can use it to set whether or not the sprite is flipped horizontally.</li>
<li>A <code>SoloAnimation</code> component which starts disabled and is used to play an <a href="#impact-animation">Impact Animation</a> when the projectile hits something.</li>
<li>A maximum <code>Lifetime</code> to limit the projectile's range.</li>
</ul>
<pre><code class="language-cs">public sealed class Projectile : MonoBehaviour
{
    [SerializeField]
    private Rigidbody2D _Rigidbody;
    public Rigidbody2D Rigidbody =&gt; _Rigidbody;

    [SerializeField]
    private SpriteRenderer _Renderer;
    public SpriteRenderer Renderer =&gt; _Renderer;

    [SerializeField]
    private SoloAnimation _ImpactAnimation;
    public SoloAnimation ImpactAnimation =&gt; _ImpactAnimation;

    [SerializeField, Seconds]
    private float _Lifetime = 3;
    public float Lifetime =&gt; _Lifetime;
</code></pre>
<p>The <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.OnValidate.html"><code>OnValidate</code></a> method automatically searches for any missing references:</p>
<pre><code class="language-cs">#if UNITY_EDITOR
    private void OnValidate()
    {
        gameObject.GetComponentInParentOrChildren(ref _Rigidbody);
        gameObject.GetComponentInParentOrChildren(ref _Renderer);
        gameObject.GetComponentInParentOrChildren(ref _ImpactAnimation);
</code></pre>
<p>Since the <code>Projectile</code> wants <code>OnTriggerEnter2D</code> messages, it also makes sure that its collider is set as a trigger. Since it is modifying another component, it specifically checks that value actually needs to be changed to avoid constantly flagging the other object as modified.</p>
<pre><code class="language-cs">        if (TryGetComponent&lt;Collider2D&gt;(out var collider) &amp;&amp;
            !collider.isTrigger)
            collider.isTrigger = true;
    }
#endif
</code></pre>
<p>When launched, it sets the <code>velocity</code>, stores the details of the attack, and resisters the object to be destroyed if its <code>Lifetime</code> expires:</p>
<pre><code class="language-cs">    public Team Team { get; set; }
    public int Damage { get; set; }
    public HashSet&lt;Hit.ITarget&gt; Ignore { get; set; }

    public void Fire(Vector2 velocity, Team team, int damage, HashSet&lt;Hit.ITarget&gt; ignore)
    {
        _Rigidbody.velocity = velocity;

        Team = team;
        Damage = damage;
        Ignore = ignore;

        Destroy(gameObject, _Lifetime);
    }
</code></pre>
<p>When the projectile's trigger touches something:</p>
<ul>
<li>If the object doesn't have any component that implements the <code>Hit.ITarget</code> interface, the method continues to destroy the projectile. This happens when the projectile touches a wall.</li>
<li>Otherwise the projectile tries to hit the target:
<ul>
<li>If it fails to hit, the method returns immediately so it can continue onwards and try to hit other things. This happens when the projectile passes through an ally (or it would if the <em>Player</em> had any allies).</li>
<li>If it hits the target successfully, the method continues to destroy the projectile. This happend when the projectile touches an enemy.</li>
</ul>
</li>
</ul>
<pre><code class="language-cs">    private void OnTriggerEnter2D(Collider2D collider)
    {
        var target = Hit.GetTarget(collider);
        if (target != null)
        {
            var hit = new Hit(transform, Team, Damage, Ignore);
            if (!hit.TryHit(target))
                return;
        }
</code></pre>
<p>Now that the projectile has touched something it can't pass through:</p>
<ul>
<li>If there is no <code>_ImpactAnimation</code>, it is destroyed immediately.</li>
<li>Otherwise, its physics is disabled, that animation is played, and the projectile is registered to be destroyed when the animation finishes.</li>
</ul>
<pre><code class="language-cs">        if (_ImpactAnimation == null)
        {
            Destroy(gameObject);
        }
        else
        {
            _Rigidbody.simulated = false;
            _ImpactAnimation.enabled = true;
            Destroy(gameObject, _ImpactAnimation.Clip.length / _ImpactAnimation.Speed);
        }
    }
</code></pre>
<p>If the collider has a target but it didn't accept the hit, this projectile passes through them.</p>
<p>When this component is destroyed or disabled, it releases the set of objects it can't hit back to the <code>ObjectPool</code>:</p>
<pre><code class="language-cs">    private void OnDisable()
    {
        if (Ignore != null)
            ObjectPool.Release(Ignore);
    }
}
</code></pre>
<img src="sword-animation.png" class="img-responsive img-right" style="padding-bottom:1em">
<h1 id="impact-animation">Impact Animation</h1>
<p><img src="projectile-impact.gif" class="img-responsive"></p>
<p>The <em>Player</em>'s thrown sword has a simple animation which it plays using Animancer's <a href="/animancer/docs/examples/fine-control/solo-animation"><code>SoloAnimation</code></a> component when it hits something.</p>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                <strong><div style="text-align:left; display:flex">

<div>
<p>Documentation</p>
<p><a href="/platformer/docs/examples">Examples</a></p>
<p><a href="/platformer/docs/manual">User Manual</a></p>
<p><a href="/platformer/docs/changes">Change Log</a></p>
</div>

<div style="width:10%"></div>

<div>
<p>Download</p>
<p><a href="https://kybernetik.itch.io/platformer">Itch.io (Recommended)</a></p>
<p><a href="https://assetstore.unity.com/packages/tools/animation/animancer-pro-116514?aid=1100l8ah5">Asset Store</a></p>
<p><a href="/animancer">Animancer</a></p>
</div>

<div style="width:10%"></div>

<div>
<p>Contact</p>
<p><a href="https://github.com/KybernetikGames/platformer/issues">Github Issues</a></p>
<p><a href="/platformer/forum">Unity Forum</a></p>
<p><a href="mailto:mail@kybernetik.com.au?subject=Platformer%20Game%20Kit">Email</a></p>
</div>

<div style="width:10%"></div>

<div>
<p>Other Assets</p>
<p><a href="/inspector-gadgets">Inspector Gadgets</a></p>
<p><a href="/weaver">Weaver</a></p>
<p><a href="/ultevents">UltEvents</a></p>
</div>

</div></strong>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>