<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/platformer/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/platformer/assets/img/favicon.ico" type="image/x-icon">
        <title>Platformer Game Kit - Camera Shake</title>
        <link href="/platformer/assets/css/highlight.css" rel="stylesheet">
        <link href="/platformer/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/platformer/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/platformer/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/platformer/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/platformer/assets/css/override.css" rel="stylesheet">
        <script src="/platformer/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/platformer/assets/js/bootstrap.min.js"></script>        
        <script src="/platformer/assets/js/app.min.js"></script>         
        <script src="/platformer/assets/js/highlight.pack.js"></script>   
        <script src="/platformer/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/platformer/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/platformer/assets/js/mermaid.min.js"></script>
        <script src="/platformer/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/platformer/assets/js/html5shiv.min.js"></script>
        <script src="/platformer/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/platformer/" class="logo">
                            <span>Platformer Game Kit</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/platformer/docs"><img src="/platformer/images/docs.png" height="20px" width="7.5px" style="left:-5px"> Documentation</a></li>
        <li><a href="/platformer/docs/package/download"><img src="/platformer/images/unity-logo.png" height="20px" width="19.0625px" style="left:-4px"> Download</a></li>
        <li><a href="/platformer/api/PlatformerGameKit"><img src="/platformer/images/api.png" height="20px" width="18.125px" style="left:-3px"> API v1.1</a></li>
        <li><a href="/platformer/docs/package/contact"><img src="/platformer/images/contact.png" height="20px" width="19.6875px" style="left:-4px"> Contact</a></li>
        <li><a href="https://kybernetik.com.au"><img src="/platformer/images/kybernetik.png" height="20px" width="20px" style="left:-2px"> Other Assets</a></li>

<li style="width:100%">
<form class="search-form" name="search" action="/platformer/search">
<span><input class="search-input" id="search" name="q" type="text" placeholder="Search..."></span>
<div class="search-button"><button type="submit"><i class="fa fa-search"></i></button></div>
</form>
</li> 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#fields">Fields</a></p>
<p><a href="#when-hit">When Hit</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li class="treeview">
                    <a href="/platformer/docs/package">Package</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/package/download">Download</a></li>
                <li><a href="/platformer/docs/package/contact">Contact</a></li>
                <li><a href="/platformer/docs/package/license">License</a></li>

                    </ul>
                </li>
                <li><a href="/platformer/docs/scenes">Scenes</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/art">Art</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/art/import">Import</a></li>
                <li><a href="/platformer/docs/art/organization">Organization</a></li>
                <li><a href="/platformer/docs/art/animations">Animations</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters">Characters</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/character">Character Component</a></li>
                <li><a href="/platformer/docs/characters/animancer">Animancer Component</a></li>
                <li><a href="/platformer/docs/characters/physics">Physics</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/brains">Brains</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/platformer/docs/characters/brains/player">Player Brain</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/brains/player/player-input-manager">Player Input Manager</a></li>
                <li><a href="/platformer/docs/characters/brains/player/player-input-system">Player Input System</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/brains/behaviour">Behaviour Tree Brain</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/brains/behaviour/introduction">Introduction</a></li>
                <li><a href="/platformer/docs/characters/brains/behaviour/general">General Nodes</a></li>
                <li><a href="/platformer/docs/characters/brains/behaviour/specific">Specific Nodes</a></li>
                <li><a href="/platformer/docs/characters/brains/behaviour/enemies">Enemies</a></li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states">States</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/introduction">Introduction</a></li>
                <li><a href="/platformer/docs/characters/states/multi-state">Multi-State</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states/idle">Idle</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/idle/idle">Idle</a></li>
                <li><a href="/platformer/docs/characters/states/idle/mobile-idle">Mobile Idle</a></li>
                <li><a href="/platformer/docs/characters/states/idle/locomotion">Locomotion</a></li>
                <li><a href="/platformer/docs/characters/states/idle/wall-slide">Wall Slide</a></li>
                <li><a href="/platformer/docs/characters/states/idle/land">Land</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states/jump">Jump</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/jump/jump">Jump</a></li>
                <li><a href="/platformer/docs/characters/states/jump/hold">Hold Jump</a></li>
                <li><a href="/platformer/docs/characters/states/jump/wall">Wall Jump</a></li>
                <li><a href="/platformer/docs/characters/states/jump/air">Air Jump</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states/attack">Attack</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/attack/basic">Basic Action</a></li>
                <li><a href="/platformer/docs/characters/states/attack/advanced">Advanced Attack</a></li>
                <li><a href="/platformer/docs/characters/states/attack/side">Side Attack</a></li>

                    </ul>
                </li>
                <li><a href="/platformer/docs/characters/states/flinch">Flinch</a></li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/combat">Combat</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/combat/hits">Hits</a></li>
                <li><a href="/platformer/docs/combat/melee">Melee Attacks</a></li>
                <li><a href="/platformer/docs/combat/ranged">Ranged Attacks</a></li>
                <li><a href="/platformer/docs/combat/teams">Teams</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/platformer/docs/other">Other Topics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/other/camera-man">Camera Man</a></li>
                <li class="selected"><a href="/platformer/docs/other/camera-shake">Camera Shake</a></li>
                <li><a href="/platformer/docs/other/layers">Physics Layers</a></li>
                <li><a href="/platformer/docs/other/moving">Moving Platforms</a></li>

                    </ul>
                </li>
                <li><a href="/platformer/docs/changes">Changes</a></li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>Camera Shake</h1>
		</section>
	<section class="content">
		<img src="shake.gif" class="img-responsive img-right">
<p>The <em>Main Camera</em> prefab has a <code><a href="/platformer/api/PlatformerGameKit/CameraShake">CameraShake</a></code> component to make it shake in response to certain events based on the GDC talk:</p>
<iframe width="200" height="113" src="https://www.youtube.com/embed/tu-Qe66AvtY?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" title="Math for Game Programmers: Juicing Your Cameras With Math"></iframe>
<p>Currently, the only event that causes it is the <em>Player</em> getting hit, which is implemented by the <code><a href="/platformer/api/PlatformerGameKit/CameraShakeWhenHit">CameraShakeWhenHit</a></code> component attached to the <em>Player</em> prefab, but any other script could easily add to the <code>CameraShake.Instance.Magnitude</code>.</p>
<h1 id="fields">Fields</h1>
<p>As explained in the video above, shaking the X and Y Position and the Z Rotation works well for a 2D platformer:</p>
<p><img src="shake.png" class="img-responsive"></p>
<p>The fields have tooltips explaining what they do and <a href="/animancer/docs/manual/other/units">Units Attributes</a> where appropriate (unfortunately, they don't work on <code>Vector3</code> fields so the tooltips need to specify their units):</p>
<pre><code class="language-cs">public sealed class <a href="/platformer/api/PlatformerGameKit/CameraShake">CameraShake</a> : MonoBehaviour
{
    [SerializeField]
    [Tooltip("The maximum distance the shake can move the camera on each axis (in meters)")]
    private Vector3 _PositionStrength;
    public ref Vector3 PositionStrength =&gt; ref _PositionStrength;

    [SerializeField]
    [Tooltip("The maximum angle the shake can rotate the camera on each axis (in degrees)")]
    private Vector3 _RotationStrength;
    public ref Vector3 RotationStrength =&gt; ref _RotationStrength;

    [SerializeField, Multiplier]
    [Tooltip("The rate at which the shake values change")]
    private float _Frequency = 6;
    public ref float Frequency =&gt; ref _Frequency;

    [SerializeField, Units(" ^")]
    [Tooltip("The current magnitude is raised to this power to calculate the actual shake magnitude")]
    private float _MagnitudeExponent = 1;
    public ref float MagnitudeExponent =&gt; ref _MagnitudeExponent;

    [SerializeField, Units(" /s")]
    [Tooltip("The rate at which the magnitude decreases")]
    private float _Damping = 1.5f;
    public ref float Damping =&gt; ref _Damping;
</code></pre>
<p>The <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.OnValidate.html"><code>OnValidate</code></a> method ensures that all fields have reasonable values and disables this component (unless it is currently in use, to prevent it from cancelling the shake if you modify its fields in Play Mode):</p>
<pre><code class="language-cs">#if UNITY_EDITOR
    private void OnValidate()
    {
        PlatformerUtilities.NotNegative(ref _Frequency);
        _MagnitudeExponent = Mathf.Clamp(_MagnitudeExponent, 0.2f, 5f);
        PlatformerUtilities.NotNegative(ref _Damping);

        if (_Magnitude &lt;= 0)
            enabled = false;
    }
#endif
</code></pre>
<p>The <code>Magnitude</code> property is a normalized value which determines how much shake is currently being applied:</p>
<ul>
<li><code>1</code> uses the full <code>_PositionStrength</code> and <code>_RotationStrength</code>.</li>
<li><code>0</code> turns off the shake.</li>
<li>The <code>Magnitude</code> is constantly decreased by the <code>_Damping</code> value.</li>
</ul>
<pre><code class="language-cs">    private float _Magnitude;

    public float Magnitude
    {
        get =&gt; _Magnitude;
        set
        {
            _Magnitude = Mathf.Clamp01(value);
            enabled = value &gt; 0;
        }
    }

    private void Update()
    {
        _Magnitude -= _Damping * Time.deltaTime;
        if (_Magnitude &lt;= 0)
        {
            enabled = false;
            return;
        }
        ...
</code></pre>
<p>It has a static <code>Instance</code> property which it assigns itself to on startup so that other scripts (such as the <a href="#on-hit">Camera Shake On Hit</a> component) can access it:</p>
<pre><code class="language-cs">    public static <a href="/platformer/api/PlatformerGameKit/CameraShake">CameraShake</a> Instance { get; private set; }

    private void Awake()
    {
        Debug.Assert(Instance == null, $"Another {nameof(CameraShake)} instance already exists", this);
        Instance = this;
        ...
    }
</code></pre>
<p>Since the <code>Transform</code> is used frequently, it is stored in a field on startup to improve performance:</p>
<pre><code class="language-cs">    private Transform _Transform;

    private void Awake()
    {
        ...
        _Transform = transform;
    }
</code></pre>
<p>The amount of shake applied each frame is stored in the <code>_PositionOffset</code> and <code>_RotationOffset</code> fields so that on the next frame the previous shake values can be subtracted from the <code>Transform</code> before new values are applied. This allows the shake to always be a controlled offset from wherever the camera is supposed to be rather than building upon itself every frame.</p>
<pre><code class="language-cs">    private Vector3 _PositionOffset;
    private Vector3 _RotationOffset;

    private void LateUpdate()
    {
        ...

        _Transform.position -= _PositionOffset;
        _Transform.eulerAngles -= _RotationOffset;

        // ... Calculate new shake values.

        _Transform.position += _PositionOffset;
        _Transform.eulerAngles += _RotationOffset;
    }
</code></pre>
<p>The actual <code>magnitude</code> of the shake is calculated based on the linearly decreasing <code>Magnitude</code> raised to the power of the <code>_MagnitudeExponent</code> to improve the way the shake fades out. The reasoning behind this is explained in the video at the top of the page.</p>
<pre><code class="language-cs">    private void LateUpdate()
    {
        ...

        var magnitude = Mathf.Pow(_Magnitude, _MagnitudeExponent);

        var time = _Frequency * Time.timeSinceLevelLoad;

        _PositionOffset.x = Noise(_PositionStrength.x, magnitude, 0, time);
        _PositionOffset.y = Noise(_PositionStrength.y, magnitude, 1, time);
        _PositionOffset.z = Noise(_PositionStrength.z, magnitude, 2, time);
        _RotationOffset.x = Noise(_RotationStrength.x, magnitude, 3, time);
        _RotationOffset.y = Noise(_RotationStrength.y, magnitude, 4, time);
        _RotationOffset.z = Noise(_RotationStrength.z, magnitude, 5, time);

        ...
    }
</code></pre>
<p>The actual noise calculation is based on Unity's <code>Mathf.PerlinNoise</code> function with a simple check to skip the calculation if the <code>baseStrength</code> is <code>0</code>:</p>
<pre><code class="language-cs">    private static float Noise(float baseStrength, float magnitude, float x, float y) =&gt;
        baseStrength == 0 ?
        0 :// Avoid the actual Noise lookup for values we aren't using.
        baseStrength * magnitude * Noise(x, y);

    private static float Noise(float x, float y) =&gt; Mathf.PerlinNoise(x, y) * 2 - 1;
</code></pre>
<p>If this script is disabled (or destroyed), it undoes its offsets and clears the <code>Magnitude</code>:</p>
<pre><code class="language-cs">    private void OnDisable()
    {
        _Transform.position -= _PositionOffset;
        _Transform.eulerAngles -= _RotationOffset;

        _Magnitude = 0;
        _PositionOffset = _RotationOffset = default;
    }
}
</code></pre>
<img src="shake-when-hit.png" class="img-responsive img-right">
<h1 id="when-hit">When Hit</h1>
<p>The <em>Player</em> prefab has a <code><a href="/platformer/api/PlatformerGameKit/CameraShakeWhenHit">CameraShakeWhenHit</a></code> component which registers a callback to their <code>Health.OnHitReceived</code> prefab to add to the <code><a href="/platformer/api/PlatformerGameKit/CameraShake/8FEAAB15">CameraShake.Magnitude</a></code>. There isn't really anything else in the script that needs explaining.</p>
<pre><code class="language-cs">public sealed class <a href="/platformer/api/PlatformerGameKit/CameraShakeWhenHit">CameraShakeWhenHit</a> : MonoBehaviour
{
    [SerializeField]
    private <a href="/platformer/api/PlatformerGameKit/Health">Health</a> _Health;
    public <a href="/platformer/api/PlatformerGameKit/Health">Health</a> <a href="/platformer/api/PlatformerGameKit/Health">Health</a> =&gt; _Health;

    [SerializeField, Multiplier]
    [Tooltip("The shake magnitude to apply regardless of damage taken")]
    private float _BaseMagnitude = 0.3f;
    public ref float BaseMagnitude =&gt; ref _BaseMagnitude;

    [SerializeField, Multiplier]
    [Tooltip("The additional shake magnitude which is multiplied by the damage taken")]
    private float _ScalingMagnitude = 0.02f;
    public ref float ScalingMagnitude =&gt; ref _ScalingMagnitude;

#if UNITY_EDITOR
    private void OnValidate()
    {
        gameObject.GetComponentInParentOrChildren(ref _Health);
        PlatformerUtilities.NotNegative(ref _BaseMagnitude);
        PlatformerUtilities.NotNegative(ref _ScalingMagnitude);
    }
#endif

    private void Awake()
    {
        _Health.OnHitReceived += (hit) =&gt;
        {
            CameraShake.Instance.Magnitude += _BaseMagnitude + hit.damage * _ScalingMagnitude;
        };
    }
}
</code></pre>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                <strong>
  <div style="text-align:left; display:flex">

    <div>
      <p>Download</p>
      <p>
        <a href="https://kybernetik.itch.io/platformer">Itch.io (Recommended)</a>
      </p>
      <p>
        <a href="https://assetstore.unity.com/packages/tools/game-toolkits/platformer-game-kit-200756?aid=1100l8ah5">Asset Store</a>
      </p>
      <p>
        <a href="/animancer">Animancer</a>
      </p>
    </div>

    <div style="width:10%"></div>

    <div>
      <p>Contact</p>
      <p>
        <a href="https://github.com/KybernetikGames/platformer/issues">Github Issues</a>
      </p>
      <p>
        <a href="/platformer/forum">Unity Forum</a>
      </p>
      <p>
        <a href="mailto:mail@kybernetik.com.au?subject=Platformer%20Game%20Kit">Email</a>
      </p>
    </div>

    <div style="width:10%"></div>

    <div>
      <p>Other Assets</p>
      <p>
        <a href="/inspector-gadgets">Inspector Gadgets</a>
      </p>
      <p>
        <a href="/weaver">Weaver</a>
      </p>
      <p>
        <a href="/ultevents">UltEvents</a>
      </p>
    </div>

  </div>
</strong>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>