<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/platformer/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/platformer/assets/img/favicon.ico" type="image/x-icon">
        <title>Platformer Game Kit - Animancer Component</title>
        <link href="/platformer/assets/css/highlight.css" rel="stylesheet">
        <link href="/platformer/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/platformer/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/platformer/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/platformer/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/platformer/assets/css/override.css" rel="stylesheet">
        <script src="/platformer/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/platformer/assets/js/bootstrap.min.js"></script>        
        <script src="/platformer/assets/js/app.min.js"></script>         
        <script src="/platformer/assets/js/highlight.pack.js"></script>   
        <script src="/platformer/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/platformer/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/platformer/assets/js/mermaid.min.js"></script>
        <script src="/platformer/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/platformer/assets/js/html5shiv.min.js"></script>
        <script src="/platformer/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/platformer/" class="logo">
                            <span>Platformer Game Kit</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/platformer/docs"><img src="/platformer/images/docs.png" height="20px" width="7.5px" style="left:-5px"> Documentation</a></li>
        <li><a href="/platformer/docs/package/download"><img src="/platformer/images/unity-logo.png" height="20px" width="19.0625px" style="left:-4px"> Download</a></li>
        <li><a href="/platformer/api/PlatformerGameKit"><img src="/platformer/images/api.png" height="20px" width="18.125px" style="left:-3px"> API v1.0</a></li>
        <li><a href="/platformer/docs/package/contact"><img src="/platformer/images/contact.png" height="20px" width="19.6875px" style="left:-4px"> Contact</a></li>
        <li><a href="/kailas-dierk/unity-assets"><img src="/platformer/images/kybernetik.png" height="20px" width="20px" style="left:-2px"> Other Assets</a></li>

<li style="width:100%">
<form class="search-form" name="search" action="/platformer/search">
<span><input class="search-input" id="search" name="q" type="text" placeholder="Search..."></span>
<div class="search-button"><button type="submit"><i class="fa fa-search"></i></button></div>
</form>
</li> 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#fields">Fields</a></p>
<p><a href="#fading">Fading</a></p>
<p><a href="#facing">Facing</a></p>
<p><a href="#hit-boxes">Hit Boxes</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li class="treeview">
                    <a href="/platformer/docs/package">Package</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/package/download">Download</a></li>
                <li><a href="/platformer/docs/package/contact">Contact</a></li>
                <li><a href="/platformer/docs/package/license">License</a></li>

                    </ul>
                </li>
                <li><a href="/platformer/docs/scenes">Scenes</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/art">Art</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/art/import">Import</a></li>
                <li><a href="/platformer/docs/art/organization">Organization</a></li>
                <li><a href="/platformer/docs/art/animations">Animations</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/platformer/docs/characters">Characters</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/character">Character Component</a></li>
                <li class="selected"><a href="/platformer/docs/characters/animancer">Animancer Component</a></li>
                <li><a href="/platformer/docs/characters/physics">Physics</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/brains">Brains</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/brains/player">Player Input Brain</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/brains/behaviour">Behaviour Tree Brain</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/brains/behaviour/introduction">Introduction</a></li>
                <li><a href="/platformer/docs/characters/brains/behaviour/general">General Nodes</a></li>
                <li><a href="/platformer/docs/characters/brains/behaviour/specific">Specific Nodes</a></li>
                <li><a href="/platformer/docs/characters/brains/behaviour/enemies">Enemies</a></li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states">States</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/introduction">Introduction</a></li>
                <li><a href="/platformer/docs/characters/states/multi-state">Multi-State</a></li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states/idle">Idle</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/idle/idle">Idle</a></li>
                <li><a href="/platformer/docs/characters/states/idle/mobile-idle">Mobile Idle</a></li>
                <li><a href="/platformer/docs/characters/states/idle/locomotion">Locomotion</a></li>
                <li><a href="/platformer/docs/characters/states/idle/wall-slide">Wall Slide</a></li>
                <li><a href="/platformer/docs/characters/states/idle/land">Land</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states/jump">Jump</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/jump/jump">Jump</a></li>
                <li><a href="/platformer/docs/characters/states/jump/hold">Hold Jump</a></li>
                <li><a href="/platformer/docs/characters/states/jump/wall">Wall Jump</a></li>
                <li><a href="/platformer/docs/characters/states/jump/air">Air Jump</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/characters/states/attack">Attack</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/characters/states/attack/basic">Basic Action</a></li>
                <li><a href="/platformer/docs/characters/states/attack/advanced">Advanced Attack</a></li>
                <li><a href="/platformer/docs/characters/states/attack/side">Side Attack</a></li>

                    </ul>
                </li>
                <li><a href="/platformer/docs/characters/states/flinch">Flinch</a></li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/combat">Combat</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/combat/hits">Hits</a></li>
                <li><a href="/platformer/docs/combat/melee">Melee Attacks</a></li>
                <li><a href="/platformer/docs/combat/ranged">Ranged Attacks</a></li>
                <li><a href="/platformer/docs/combat/teams">Teams</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/platformer/docs/other">Other Topics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/platformer/docs/other/camera-man">Camera Man</a></li>
                <li><a href="/platformer/docs/other/camera-shake">Camera Shake</a></li>
                <li><a href="/platformer/docs/other/layers">Physics Layers</a></li>
                <li><a href="/platformer/docs/other/moving">Moving Platforms</a></li>

                    </ul>
                </li>
                <li><a href="/platformer/docs/changes">Changes</a></li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>Animancer Component</h1>
		</section>
	<section class="content">
		<img src="animancer.png" class="img-responsive img-right">
<p>Characters need a few other features in addition to the animation functions of the <code>AnimancerComponent</code>, so rather than having two separate components and needing to both be referenced by the <code><a href="/platformer/api/PlatformerGameKit.Characters/Character">Character</a></code>, we just have a <code><a href="/platformer/api/PlatformerGameKit.Characters/CharacterAnimancerComponent">CharacterAnimancerComponent</a></code> <a href="/animancer/docs/introduction/cs/inheritance">Inherit</a> from the base <code>AnimancerComponent</code>.</p>
<p>The main things it manages are:</p>
<ul>
<li>The direction the character is <a href="#facing">Facing</a>.</li>
<li>The character's currently active <a href="#hit-boxes">Hit Boxes</a>.</li>
</ul>
<h1 id="fields">Fields</h1>
<p>The <a href="/animancer/docs/introduction/cs/variables#serialized-fields">Serialized Fields</a> and <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.OnValidate.html"><code>OnValidate</code></a> method are self-explanatory:</p>
<pre><code class="language-cs">public sealed class <a href="/platformer/api/PlatformerGameKit.Characters/CharacterAnimancerComponent">CharacterAnimancerComponent</a> : AnimancerComponent
{
    [SerializeField]
    private SpriteRenderer _Renderer;
    public SpriteRenderer Renderer =&gt; _Renderer;

    [SerializeField]
    private <a href="/platformer/api/PlatformerGameKit.Characters/Character">Character</a> _Character;
    public <a href="/platformer/api/PlatformerGameKit.Characters/Character">Character</a> <a href="/platformer/api/PlatformerGameKit.Characters/Character">Character</a> =&gt; _Character;

#if UNITY_EDITOR
    private void OnValidate()
    {
        gameObject.GetComponentInParentOrChildren(ref _Renderer);
        gameObject.GetComponentInParentOrChildren(ref _Character);
    }
#endif
</code></pre>
<h1 id="fading">Fading</h1>
<p>Most of the Platformer Game Kit would work exactly the same with 3D Models or bone based <code>Sprite</code> animations, but since this script manages the direction the character is <a href="#facing">Facing</a>, it is written specifically for <code>Sprite</code> based animations which means that <a href="/animancer/docs/manual/blending/fading">Cross Fading</a> will not actually do anything useful so it uses the <code>DontAllowFade</code> system to log a warning if ever a fade occurs by accident (generally due to an incorrectly configured <a href="/animancer/docs/manual/transitions">Transition</a>):</p>
<pre><code class="language-cs">#if UNITY_ASSERTIONS
    private void Awake()
    {
        DontAllowFade.Assert(this);
    }
#endif
</code></pre>
<p>There is also a separate script called <code>DefaultFadeDuration.cs</code> in the <em>Utilities</em> folder to automatically set the <code>AnimancerPlayable.DefaultFadeDuration</code> to <code>0</code> instead of the usual <code>0.25</code>:</p>
<pre><code class="language-cs">namespace Animancer
{
    internal static class DefaultFadeDuration
    {
        [UnityEngine.RuntimeInitializeOnLoadMethod(UnityEngine.RuntimeInitializeLoadType.BeforeSceneLoad)]
        private static void Initialize() =&gt; AnimancerPlayable.DefaultFadeDuration = 0;
    }
}
</code></pre>
<p>Even though that script is part of the Platformer Game Kit, it's important for that initialization to be done by a class named <code>DefaultFadeDuration</code> in the <code>Animancer</code> namespace so that Animancer can find and run it immediately when it loads (before even the <code>[RuntimeInitializeOnLoadMethod]</code> gets executed) so that <a href="/animancer/docs/manual/transitions">Transitions</a> can use the correct value as their default.</p>
<img src="sprite-renderer.png" class="img-responsive img-right">
<h1 id="facing">Facing</h1>
<p>This system determines whether a character is facing left or right by simply using the <code>Flip X</code> toggle on the <code>SpriteRenderer</code> so it exposes several properties for accessing it and converting to and from actual directions:</p>
<pre><code class="language-cs">    public bool FacingLeft
    {
        get =&gt; _Renderer.flipX;
        set =&gt; _Renderer.flipX = value;
    }

    public float FacingX
    {
        get =&gt; _Renderer.flipX ? -1f : 1f;
        set
        {
            if (value != 0)
                _Renderer.flipX = value &lt; 0;
        }
    }

    public Vector2 Facing
    {
        get =&gt; new Vector2(FacingX, 0);
        set =&gt; FacingX = value.x;
    }
</code></pre>
<p>Every <code>Update</code>, if the character's current state's <code>CanTurn</code> property returns true, the <code>Facing</code> is set to match their <code>MovementDirection</code>:</p>
<pre><code class="language-cs">    private void Update()
    {
        if (Character.StateMachine.CurrentState.CanTurn)
            Facing = Character.MovementDirection;
    }
</code></pre>
<h1 id="hit-boxes">Hit Boxes</h1>
<p>The <a href="../../combat">Combat</a> system uses <a href="/animancer/docs/manual/events/animancer">Animancer Events</a> to determine when to activate each of the <a href="#hit-boxes">Hit Boxes</a> in an attack animation. Each frame can have different hit details as shown in the following images:</p>
<p></p><table><tbody><tr>
<td><img src="hit-1.png" class="img-responsive"></td>
<td style="width:1em"></td>
<td><img src="hit-2.png" class="img-responsive"></td>
</tr></tbody></table><p></p>
<p>The events are set up so that the attack data could potentially be shared by multiple characters, which means they can't directly reference their character and need to instead get the character each time an event occurs using one of the following methods:</p>
<pre><code class="language-cs">    public static <a href="/platformer/api/PlatformerGameKit.Characters/CharacterAnimancerComponent">CharacterAnimancerComponent</a> GetCurrent() =&gt; Get(AnimancerEvent.CurrentState);

    public static <a href="/platformer/api/PlatformerGameKit.Characters/CharacterAnimancerComponent">CharacterAnimancerComponent</a> Get(AnimancerNode node) =&gt; Get(node.Root);
    
    public static <a href="/platformer/api/PlatformerGameKit.Characters/CharacterAnimancerComponent">CharacterAnimancerComponent</a> Get(AnimancerPlayable animancer) =&gt; animancer.Component as CharacterAnimancerComponent;
</code></pre>
<p>Even though each attack can consist of multiple different hit boxes, a single attack can only hit each target once so the system needs to keep track of the character's active hit boxes and the targets they have already hit:</p>
<pre><code class="language-cs">    private Dictionary&lt;HitData, <a href="/platformer/api/PlatformerGameKit/HitTrigger">HitTrigger</a>&gt; _ActiveHits;
    private HashSet&lt;<a href="/platformer/api/PlatformerGameKit/ITarget">Hit.ITarget</a>&gt; _IgnoreHits;

    public void AddHitBox(HitData data)
    {
        if (_IgnoreHits == null)
        {
            ObjectPool.Acquire(out _ActiveHits);
            ObjectPool.Acquire(out _IgnoreHits);
        }

        _ActiveHits.Add(data, HitTrigger.Activate(Character, data, FacingLeft, _IgnoreHits));
    }

    public void RemoveHitBox(HitData data)
    {
        if (_ActiveHits.TryGetValue(data, out var trigger))
        {
            trigger.Deactivate();
            _ActiveHits.Remove(data);
        }
    }
</code></pre>
<p>And when an attack ends or this script gets disabled (generally because it was destroyed) it clears all the hit boxes and returns the set of objects that have been hit to the <code>ObjectPool</code>:</p>
<pre><code class="language-cs">    public void EndHitSequence()
    {
        if (_IgnoreHits == null)
            return;

        ClearHitBoxes();
        ObjectPool.Release(ref _ActiveHits);
        ObjectPool.Release(ref _IgnoreHits);
    }

    public void ClearHitBoxes()
    {
        if (_ActiveHits != null)
        {
            foreach (var trigger in _ActiveHits.Values)
                trigger.Deactivate();
            _ActiveHits.Clear();
        }
    }

    protected override void OnDisable()
    {
        EndHitSequence();
        base.OnDisable();
    }
}
</code></pre>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                <strong>
  <div style="text-align:left; display:flex">

    <div>
      <p>Download</p>
      <p>
        <a href="https://kybernetik.itch.io/platformer">Itch.io (Recommended)</a>
      </p>
      <p>
        <a href="https://assetstore.unity.com/packages/tools/animation/animancer-pro-116514?aid=1100l8ah5">Asset Store</a>
      </p>
      <p>
        <a href="/animancer">Animancer</a>
      </p>
    </div>

    <div style="width:10%"></div>

    <div>
      <p>Contact</p>
      <p>
        <a href="https://github.com/KybernetikGames/platformer/issues">Github Issues</a>
      </p>
      <p>
        <a href="/platformer/forum">Unity Forum</a>
      </p>
      <p>
        <a href="mailto:mail@kybernetik.com.au?subject=Platformer%20Game%20Kit">Email</a>
      </p>
    </div>

    <div style="width:10%"></div>

    <div>
      <p>Other Assets</p>
      <p>
        <a href="/inspector-gadgets">Inspector Gadgets</a>
      </p>
      <p>
        <a href="/weaver">Weaver</a>
      </p>
      <p>
        <a href="/ultevents">UltEvents</a>
      </p>
    </div>

  </div>
</strong>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>